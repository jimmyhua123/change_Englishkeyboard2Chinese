# README：AutoHotkey v1.1 「英文亂碼→中文輸入」工具

## 1. 專案簡介（Project Overview）

當您在 Windows 忘記切換輸入法，於 **英文鍵盤佈景（Keyboard Layout）** 下輸入了注音字母與聲調數字而出現「亂碼」時，本腳本可透過 **左 Alt + F2** 熱鍵自動：

1. 讀取選取的亂碼字串。
2. 切換到 **微軟注音輸入法（Microsoft Bopomofo）**，並強制進入 **中文模式（Native Mode）**。
3. 逐字重新輸入並送出空格，直接以上屏第一候選字。
4. 還原原先的鍵盤佈景與剪貼簿內容。

## 2. 系統需求（Prerequisites）

* **Windows 10/11**，已安裝並啟用「微軟注音輸入法」。
* **AutoHotkey v1.1**（[https://www.autohotkey.com/）。](https://www.autohotkey.com/)
* 管理員權限非必要，但某些程式（例如 UWP App）可能需以系統權限才能攔截鍵盤事件。

## 3. 安裝（Installation）

1. 將 `IME_Fix.ahk` 置於任意資料夾。
2. 以 AutoHotkey v1.1 執行或建立捷徑放入「啟動」資料夾。
3. 首次執行時，系統右下角會出現綠色 H 圖示，表示腳本常駐。

## 4. 使用方法（Usage）

1. **反白**忘記切換輸入法所產生的英文亂碼。
2. 按 **左 Alt + F2**（僅限左側 Alt）。
3. 腳本將自動替換為正確的中文文字。

> 💡 若想同時刪除原亂碼，可自行把腳本中
> `Send ^c` 下一行改為 `Send ^x`（剪下）或 `Send {Backspace}`。

## 5. 自訂設定（Customization）

| 需求           | 修改位置                    | 說明                                                                                                     |
| ------------ | ----------------------- | ------------------------------------------------------------------------------------------------------ |
| 更換輸入法        | `IME_HKL := 0xE01E0404` | 以 `MsgBox % DllCall("GetKeyboardLayout","UInt",0,"UPtr")` 取得目標輸入法 **HKL（Keyboard Layout Handle）** 後替換。 |
| 自訂熱鍵         | 最上方 `<!F2::`            | 改寫為 `F9::`、`^!z::`… 等任何 AutoHotkey 熱鍵語法。                                                               |
| 反覆嘗試強制中文模式次數 | `Loop, 3`               | 部分輸入法在 Imm32 API 無效時，腳本會模擬 `Ctrl + Space`；可增減次數。                                                       |

## 6. 常見問題（FAQ）

| 問題                  | 解法                                                                                |
| ------------------- | --------------------------------------------------------------------------------- |
| 第二次開始又變成英數模式        | 已在 v1.1.1 起強制每次都檢查並切回 **中文模式（Native Mode）**。若仍失敗，請確認系統自訂快捷鍵是否與 `Ctrl + Space` 衝突。 |
| 使用第三方注音（如新注音、自然輸入法） | 請先以 `MsgBox` 取得該輸入法 HKL，並測試 Imm32 API 是否支援；若不支援，腳本只會用熱鍵模擬方式切換。                    |
| 熱鍵與遊戲/IDE 衝突        | 自行修改熱鍵或限定於特定視窗：將 `<!F2::` 改為 `#IfWinActive ahk_class Notepad` 之類條件式熱鍵。            |

## 7. 進階技巧（Advanced Tips）

* **批次處理多行文字**：把 `StringReplace, rawText, rawText, \n,, All` 註解掉，即可保留換行逐行輸入。
* **內嵌字母→注音符號對照表**：若想直接輸出注音符號（ㄅ、ㄆ…），需自行建立字典並改用 `SendInput % charMap[letter]`，此屬進階自訂。
* **外掛聲調判斷**：目前脚本依靠使用者原本打好的聲調數字（1–4），若需自動補聲調，可串接 OpenCC 或詞庫進行輸入前轉換。

## 8. 版本紀錄（Changelog）

| 版本    | 日期         | 變更                                                             |
| ----- | ---------- | -------------------------------------------------------------- |
| 1.1.1 | 2025-05-26 | • 每次都強制檢查並切入中文模式<br>• 若 Imm32 API 無效自動模擬 `Ctrl + Space` 最多 3 次 |
| 1.1.0 | 2025-05-26 | • 初始版本：自動切換輸入法、重輸文字、還原環境                                       |

## 9. 授權（License）

本腳本採 **MIT License（MIT 授權）**。
您可自由修改、散布與商用，但請保留原作者註記。
